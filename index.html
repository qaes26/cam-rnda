<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØµÙˆÙŠØ± Ø§Ù„Ù‚Ù…Ø± ğŸŒ™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #050510;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        #webcam {
            object-fit: cover;
            transform: scaleX(-1); /* Ø¬Ø¹Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙƒÙ…Ø±Ø¢Ø© Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø±Ø¤ÙŠØ© */
        }

        /* Ø²ÙˆØ§ÙŠØ§ Ø§Ù„ØªØ±ÙƒÙŠØ² (Focus Brackets) */
        .focus-bracket {
            position: absolute;
            width: 40px;
            height: 40px;
            border-color: rgba(255, 255, 255, 0.6);
            border-style: solid;
            transition: all 0.3s ease;
        }
        .top-left { top: 20%; left: 10%; border-width: 3px 0 0 3px; }
        .top-right { top: 20%; right: 10%; border-width: 3px 3px 0 0; }
        .bottom-left { bottom: 25%; left: 10%; border-width: 0 0 3px 3px; }
        .bottom-right { bottom: 25%; right: 10%; border-width: 0 3px 3px 0; }

        .pulsate { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.6; }
        }

        #flash { pointer-events: none; transition: opacity 0.5s ease-out; }

        .rec-dot { animation: blink 1s infinite; }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .fade-text {
            animation: textFadeInOut 4s forwards;
        }
        @keyframes textFadeInOut {
            0% { opacity: 0; transform: translateY(10px) scale(0.95); }
            15% { opacity: 1; transform: translateY(0) scale(1); }
            85% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-10px) scale(1.05); }
        }

        .final-fade-in {
            animation: fadeIn 1s forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="relative w-screen h-screen text-white flex items-center justify-center">

    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
    <div id="error-msg" class="hidden absolute z-50 p-6 bg-red-600/90 rounded-2xl text-center shadow-xl mx-4">
        <h2 class="text-2xl font-bold mb-2">Ø¹Ø°Ø±Ø§Ù‹!</h2>
        <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„ÙƒÙŠ ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØªØªÙ…ÙƒÙ†ÙŠ Ù…Ù† Ø±Ø¤ÙŠØ© Ø§Ù„Ø³Ø­Ø±.</p>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
    <div id="welcome-screen" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-[#050510] text-white p-6 text-center transition-opacity duration-1000">
        <div class="text-7xl mb-6 animate-pulse drop-shadow-[0_0_15px_rgba(255,255,255,0.8)]">ğŸŒ•</div>
        <h1 class="text-3xl md:text-5xl font-bold mb-10 leading-tight">Ù‡ÙŠØ§ Ù„Ù†ØµÙˆØ± Ø§Ù„Ù‚Ù…Ø± ğŸŒ™</h1>
        <button id="start-btn" class="px-12 py-4 bg-white text-black font-bold rounded-full text-xl hover:scale-105 transition-transform shadow-[0_0_20px_rgba(255,255,255,0.4)]">
            Ø°Ù‡Ø§Ø¨ ğŸš€
        </button>
        <div class="absolute bottom-4 right-4 text-xs text-white/50 font-medium">
            Ù…Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ù‚ÙŠØ³ Ø¬Ø§Ø²ÙŠ
        </div>
    </div>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø© -->
    <div id="camera-container" class="hidden relative w-full h-full flex-col items-center justify-center">
        <!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø¨Ø« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§) -->
        <video id="webcam" class="absolute inset-0 w-full h-full" autoplay playsinline></video>
        
        <!-- Ø·Ø¨Ù‚Ø© ØªØºÙ…ÙŠÙ‚ Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ -->
        <div class="absolute inset-0 bg-black/10 pointer-events-none"></div>

        <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
        <div id="camera-ui" class="absolute inset-0 z-10">
            <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
            <div class="absolute top-0 left-0 w-full p-6 flex justify-between items-start text-sm md:text-base font-medium drop-shadow-md">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500 rec-dot"></div>
                    <span class="tracking-widest">LIVE</span>
                </div>
                <div class="text-center">
                    <span class="block text-xs text-gray-300">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                    <span class="font-bold text-yellow-400">Ø§Ù„ØªØµÙˆÙŠØ± Ø§Ù„ÙÙ„ÙƒÙŠ ğŸ”­</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="border border-white px-1 text-[10px] rounded">100%</span>
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17 4h-3V2h-4v2H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z"/></svg>
                </div>
            </div>

            <!-- Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØªØ±ÙƒÙŠØ² -->
            <div class="focus-bracket top-left pulsate"></div>
            <div class="focus-bracket top-right pulsate"></div>
            <div class="focus-bracket bottom-left pulsate"></div>
            <div class="focus-bracket bottom-right pulsate"></div>

            <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØºØ²Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙˆÙ‚ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none px-4">
                <h2 id="live-ghazal-text" class="text-2xl md:text-3xl font-bold text-white text-center drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)] opacity-0"></h2>
            </div>

            <!-- Ø²Ø± Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· -->
            <div class="absolute bottom-10 left-1/2 -translate-x-1/2 flex flex-col items-center gap-4">
                <p id="capture-hint" class="text-white/80 text-sm tracking-wide drop-shadow-lg opacity-0 transition-opacity duration-500">
                    Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
                </p>
                <button id="capture-btn" class="w-20 h-20 rounded-full bg-white/30 border-4 border-white backdrop-blur-sm flex items-center justify-center transition-transform active:scale-90 hover:bg-white/50 shadow-lg">
                    <div class="w-16 h-16 rounded-full bg-white"></div>
                </button>
            </div>
            
            <!-- ØªÙˆÙ‚ÙŠØ¹ Ù‚ÙŠØ³ -->
            <div class="absolute bottom-4 right-4 text-xs text-white/50 font-medium drop-shadow-md">
                Ù…Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ù‚ÙŠØ³ Ø¬Ø§Ø²ÙŠ
            </div>
        </div>

        <!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ (Ø§Ù„ÙÙ„Ø§Ø´) -->
        <div id="flash" class="absolute inset-0 bg-white opacity-0 z-20"></div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙˆÙŠØ±) -->
        <div id="result-overlay" class="hidden absolute inset-0 z-30 bg-black/70 backdrop-blur-md flex-col items-center justify-center p-6 text-center">
            <div id="message-container" class="min-h-[150px] flex items-center justify-center flex-col gap-4">
                <div class="text-5xl mb-4 animate-bounce" id="moon-icon">ğŸ”­</div>
                <h1 id="dynamic-text" class="text-2xl md:text-4xl font-bold text-white leading-relaxed max-w-lg"></h1>
            </div>

            <button id="reset-btn" class="hidden mt-10 px-8 py-3 bg-white/10 hover:bg-white/20 border border-white/50 rounded-full transition-all text-sm backdrop-blur-sm shadow-md">
                Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø£Ø®Ø±Ù‰
            </button>
            
            <div class="absolute bottom-4 right-4 text-xs text-white/50 font-medium">
                Ù…Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ù‚ÙŠØ³ Ø¬Ø§Ø²ÙŠ
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('webcam');
        const captureBtn = document.getElementById('capture-btn');
        const flash = document.getElementById('flash');
        const cameraUi = document.getElementById('camera-ui');
        const resultOverlay = document.getElementById('result-overlay');
        const dynamicText = document.getElementById('dynamic-text');
        const moonIcon = document.getElementById('moon-icon');
        const resetBtn = document.getElementById('reset-btn');
        const errorMsg = document.getElementById('error-msg');
        
        const welcomeScreen = document.getElementById('welcome-screen');
        const startBtn = document.getElementById('start-btn');
        const cameraContainer = document.getElementById('camera-container');
        const liveGhazalText = document.getElementById('live-ghazal-text');
        const captureHint = document.getElementById('capture-hint');

        let cameraStream = null;

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© ÙˆØ·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        async function initCamera() {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" },
                    audio: false 
                });
                video.srcObject = cameraStream;
            } catch (err) {
                console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§: ", err);
                errorMsg.classList.remove('hidden');
            }
        }

        // Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', initCamera);

        // ØºØ²Ù„ ÙŠØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
        const liveGhazalMessages = [
            "ÙŠØ§ Ø£Ø­Ù„Ù‰ Ù…Ù† Ø§Ù„Ù‚Ù…Ø± Ù†ÙØ³Ù‡... âœ¨",
            "Ù†ÙˆØ± ÙˆØ¬Ù‡Ùƒ ÙŠØ§ Ø±Ù†Ø¯Ø§ ØºØ·Ù‘Ù‰ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù†Ø¬ÙˆÙ… ğŸ’«",
            "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø­ØªØ§Ø±Ø© ØªØµÙˆØ± Ù…ÙŠÙ† ÙÙŠÙƒÙ…... â¤ï¸"
        ];

        function playLiveGhazal() {
            let delayAccumulator = 0;
            
            liveGhazalMessages.forEach((msg, index) => {
                setTimeout(() => {
                    liveGhazalText.textContent = msg;
                    liveGhazalText.classList.remove('fade-text');
                    void liveGhazalText.offsetWidth; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
                    liveGhazalText.classList.add('fade-text');
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ù†Øµ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ Ù„Ù„ØªØµÙˆÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØºØ²Ù„
                    if(index === liveGhazalMessages.length - 1) {
                        setTimeout(() => {
                            captureHint.style.opacity = '1';
                        }, 3500);
                    }
                }, delayAccumulator);
                delayAccumulator += 4000; // ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© ØªØ¸Ù‡Ø± Ù„Ù…Ø¯Ø© 4 Ø«ÙˆØ§Ù†Ù
            });
        }

        // Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø°Ù‡Ø§Ø¨)
        startBtn.addEventListener('click', () => {
            // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­ Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù‡ÙˆØ§ØªÙ Ø£Ø¨Ù„
            video.play().catch(e => console.log(e));
            
            welcomeScreen.style.opacity = '0';
            setTimeout(() => {
                welcomeScreen.classList.add('hidden');
                cameraContainer.classList.remove('hidden');
                cameraContainer.classList.add('flex');
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØºØ²Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                setTimeout(playLiveGhazal, 1000);
            }, 500);
        });

        // Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        const finalMessages = [
            { text: "ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„ÙÙ„ÙƒÙŠ...", icon: "ğŸ“¡", delay: 1000 },
            { text: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ù…Ø± Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø©...", icon: "ğŸ›°ï¸", delay: 2000 },
            { text: "ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‡Ø¯Ù Ø¨Ù†Ø¬Ø§Ø­!", icon: "âœ¨", delay: 2000 },
            { text: "Ø£Ø±Ø¯Øª ØªØµÙˆÙŠØ± Ø§Ù„Ù‚Ù…Ø±...", icon: "ğŸ“¸", delay: 2000 },
            { text: "ÙÙˆØ¬Ø¯ØªÙƒÙ Ø£Ù†ØªÙ ÙŠØ§ Ø±Ù†Ø¯Ø§ ğŸŒ™â¤ï¸", icon: "ğŸ¥°", delay: 2500 }
        ];

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
        captureBtn.addEventListener('click', () => {
            flash.style.opacity = '1';
            
            setTimeout(() => {
                flash.style.opacity = '0';
                cameraUi.classList.add('hidden');
                video.pause(); // ØªØ«Ø¨ÙŠØª Ø§Ù„ØµÙˆØ±Ø©
                resultOverlay.classList.remove('hidden');
                resultOverlay.classList.add('flex');
                
                playFinalMessagesSequence();
            }, 500);
        });

        function playFinalMessagesSequence() {
            let delayAccumulator = 0;
            
            finalMessages.forEach((msg, index) => {
                setTimeout(() => {
                    dynamicText.classList.remove('final-fade-in');
                    void dynamicText.offsetWidth;
                    
                    moonIcon.textContent = msg.icon;
                    dynamicText.innerHTML = msg.text;
                    
                    dynamicText.classList.add('final-fade-in');

                    if (index === finalMessages.length - 1) {
                        dynamicText.classList.add('text-yellow-300');
                        setTimeout(() => {
                            resetBtn.classList.remove('hidden');
                        }, 1000);
                    }
                }, delayAccumulator);
                
                delayAccumulator += msg.delay;
            });
        }

        // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
        resetBtn.addEventListener('click', () => {
            resultOverlay.classList.add('hidden');
            resultOverlay.classList.remove('flex');
            cameraUi.classList.remove('hidden');
            dynamicText.classList.remove('text-yellow-300');
            resetBtn.classList.add('hidden');
            liveGhazalText.classList.remove('fade-text');
            liveGhazalText.style.opacity = '0';
            video.play(); 
            setTimeout(playLiveGhazal, 500); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØºØ²Ù„
        });
    </script>
</body>
</html>


